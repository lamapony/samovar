<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Правила чтения | Samovar</title>
    <link rel="stylesheet" href="../css/style.css" />
    <style>
      .phoneme-table {
        width: 100%;
        border-collapse: collapse;
        margin: 20px 0;
      }

      .phoneme-table th {
        background: #f8f9fa;
        padding: 10px;
        text-align: center;
        border-bottom: 2px solid var(--line-color);
      }

      .phoneme-table td {
        padding: 15px;
        text-align: center;
        border-bottom: 1px solid #eee;
        font-size: 1.2rem;
      }

      .pair-badge {
        display: inline-block;
        padding: 5px 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        margin: 5px;
        font-weight: bold;
      }

      .sound-card {
        background: white;
        border: 1px solid var(--line-color);
        border-radius: 8px;
        padding: 20px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
        transition: transform 0.2s;
      }

      .sound-card:hover {
        transform: translateX(5px);
        border-color: var(--accent-blue);
      }

      .letter-large {
        font-size: 2rem;
        font-family: var(--font-serif);
        color: var(--accent-blue);
        width: 50px;
        text-align: center;
      }

      /* Quiz */
      .quiz-options {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-top: 20px;
      }

      .quiz-btn {
        padding: 15px;
        font-size: 1.1rem;
        background: white;
        border: 2px solid #eee;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .quiz-btn:hover {
        border-color: var(--accent-blue);
        background: #f5faff;
      }

      /* Sort Game */
      .sort-area {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }

      .sort-bucket {
        flex: 1;
        border: 2px dashed #ccc;
        border-radius: 12px;
        padding: 20px;
        min-height: 150px;
        text-align: center;
        transition: background-color 0.3s;
      }

      .sort-bucket.hovered {
        background: #e3f2fd;
        border-color: var(--accent-blue);
      }

      .sort-bucket h4 {
        margin-top: 0;
        color: #666;
      }

      .draggable-tile {
        background: white;
        border: 1px solid var(--accent-blue);
        padding: 8px 15px;
        margin: 5px;
        border-radius: 4px;
        cursor: grab;
        display: inline-block;
        font-weight: bold;
      }

      .draggable-tile.correct {
        background: var(--success-color);
        color: white;
        border-color: var(--success-color);
        cursor: default;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <a href="../index.html" class="logo">Samovar.</a>
        <nav>
          <a href="../index.html">Главная</a>
          <a href="phonetics.html">Фонетика</a>
          <a
            href="reading.html"
            class="active"
            style="color: var(--text-ink); border-bottom: 1px solid var(--accent-red)"
            >Чтение</a
          >
        </nav>
      </header>

      <main class="content-block">
        <div class="content-main">
          <h1>Правила чтения</h1>
          <p class="lead">
            Русская фонетика — это система правил, где позиция буквы меняет её звук. Главные враги
            иностранца: мягкость согласных и оглушение на конце слов.
          </p>

          <section id="softness">
            <h2>1. Твердые и Мягкие согласные</h2>
            <div class="visual-concept">
              <div class="visual-desc">
                <strong>Палатализация (Смягчение)</strong>
                Чтобы произнести мягкий звук (как в слове "НЕТ"), прижмите язык к нёбу. <br />
                Гласные <strong>Я, Е, Ё, Ю, И</strong> работают как команда "Смягчить!" для
                предыдущего согласного. <br /><br />
                <em>Ма (Ma) — Твердо.</em><br />
                <em>Мя (Mja) — Мягко.</em>
              </div>
            </div>

            <h3>Знаки-призраки</h3>
            <div class="sound-card">
              <div class="letter-large">Ь</div>
              <div style="flex-grow: 1; padding-left: 20px">
                <strong>Мягкий знак (Blødt tegn)</strong><br />
                Не имеет звука. Смягчает согласный перед ним.<br />
                <em>Брат (Bror) [Brat] — Брать (At tage) [Brat']</em>
              </div>
            </div>
            <div class="sound-card">
              <div class="letter-large">Ъ</div>
              <div style="flex-grow: 1; padding-left: 20px">
                <strong>Твердый знак (Hårdt tegn)</strong><br />
                Работает как "Стоп". Разделяет согласный и гласный.<br />
                <em>Подъезд (Opgang) [Pod-yest]</em>
              </div>
            </div>

            <!-- MICRO PRACTICE: Hard/Soft -->
            <div class="inline-quiz">
              <span class="inline-question">В каком слове звук "Т" мягкий?</span>
              <div class="inline-options">
                <button
                  class="inline-btn"
                  onclick="checkInline(this, true, 'Верно! Мягкий знак смягчает Т.')"
                >
                  Мать
                </button>
                <button
                  class="inline-btn"
                  onclick="checkInline(this, false, 'Нет. Здесь Т твердый.')"
                >
                  Брат
                </button>
              </div>
              <div class="inline-feedback"></div>
            </div>

            <!-- NEW SORTING GAME -->
            <div class="game-container" style="margin-top: 30px">
              <h3>Сортировка: Твердо или Мягко?</h3>
              <p>Перетащите слова в правильную колонку (смотрите на последнюю букву).</p>

              <div id="sort-pool" style="margin-bottom: 15px"></div>

              <div class="sort-area">
                <div class="sort-bucket" data-type="hard">
                  <h4>Твердый (Hard)</h4>
                  <p style="font-size: 0.8rem; color: #999">Без Ь</p>
                  <div class="bucket-content"></div>
                </div>
                <div class="sort-bucket" data-type="soft">
                  <h4>Мягкий (Soft)</h4>
                  <p style="font-size: 0.8rem; color: #999">С Ь или И/Е/Я</p>
                  <div class="bucket-content"></div>
                </div>
              </div>
              <div id="sort-feedback" class="feedback"></div>
            </div>
          </section>

          <section id="devoicing">
            <h2>2. Оглушение (Devoicing)</h2>
            <p>
              В русском языке ленивые окончания. Если звонкий согласный (B, D, G...) стоит в конце
              слова, он превращается в своего глухого брата.
            </p>

            <table class="phoneme-table">
              <tr>
                <th>Пишем (Звонкий)</th>
                <th>Слышим (Глухой)</th>
                <th>Пример</th>
              </tr>
              <tr>
                <td><span class="pair-badge">Б</span> (B)</td>
                <td><span class="pair-badge">П</span> (P)</td>
                <td>Клу<strong>б</strong> → [Клу<strong>п</strong>]</td>
              </tr>
              <tr>
                <td><span class="pair-badge">Д</span> (D)</td>
                <td><span class="pair-badge">Т</span> (T)</td>
                <td>Горо<strong>д</strong> → [Гора<strong>т</strong>]</td>
              </tr>
              <tr>
                <td><span class="pair-badge">Г</span> (G)</td>
                <td><span class="pair-badge">К</span> (K)</td>
                <td>Дру<strong>г</strong> → [Дру<strong>к</strong>]</td>
              </tr>
              <tr>
                <td><span class="pair-badge">В</span> (V)</td>
                <td><span class="pair-badge">Ф</span> (F)</td>
                <td>Любо<strong>в</strong>ь → [Любо<strong>ф</strong>']</td>
              </tr>
              <tr>
                <td><span class="pair-badge">З</span> (Z)</td>
                <td><span class="pair-badge">С</span> (S)</td>
                <td>Гла<strong>з</strong> → [Гла<strong>с</strong>]</td>
              </tr>
              <tr>
                <td><span class="pair-badge">Ж</span> (Zh)</td>
                <td><span class="pair-badge">Ш</span> (Sh)</td>
                <td>Му<strong>ж</strong> → [Му<strong>ш</strong>]</td>
              </tr>
            </table>

            <!-- MICRO PRACTICE: Devoicing -->
            <div class="inline-quiz">
              <span class="inline-question">Как звучит слово "Глаз" (Øje)?</span>
              <div class="inline-options">
                <button
                  class="inline-btn"
                  onclick="checkInline(this, false, 'Нет. З на конце оглушается.')"
                >
                  [Глаз]
                </button>
                <button
                  class="inline-btn"
                  onclick="checkInline(this, true, 'Верно! Звучит как С.')"
                >
                  [Глас]
                </button>
              </div>
              <div class="inline-feedback"></div>
            </div>
          </section>

          <section id="special-letters">
            <h2>3. Особые правила</h2>
            <ul class="module-list">
              <li class="module-item">
                <strong>Ж, Ш, Ц</strong> — Всегда твердые. Даже если после них стоит "И" (Жи, Ши),
                мы произносим как "Ы". <br /><em>Жизнь [Жызнь] (Liv).</em>
              </li>
              <li class="module-item">
                <strong>Ч, Щ</strong> — Всегда мягкие. <br /><em>Чай [Ч'ай].</em>
              </li>
              <li class="module-item">
                <strong>ЧТО</strong> — Произносится как [ШТО]. <br /><em>Что это? [Што эта?]</em>
              </li>
            </ul>
          </section>

          <section id="practice">
            <h2>Тест на чтение</h2>
            <p>Как правильно прочитать это слово?</p>

            <div class="game-container" id="quiz-container">
              <h3
                style="
                  text-align: center;
                  font-size: 2.5rem;
                  margin-bottom: 10px;
                  font-family: var(--font-serif);
                "
              >
                ВОДКА
              </h3>
              <p style="text-align: center; color: #666">(Влияние глухого "К" на звонкий "Д")</p>

              <div class="quiz-options">
                <button class="quiz-btn" onclick="checkQuiz(this, false)">[Водка] (Четко Д)</button>
                <button class="quiz-btn" onclick="checkQuiz(this, true)">[Вотка] (Д -> Т)</button>
              </div>
              <div id="quiz-feedback" class="feedback"></div>
            </div>

            <div class="game-container" style="margin-top: 30px">
              <h3
                style="
                  text-align: center;
                  font-size: 2.5rem;
                  margin-bottom: 10px;
                  font-family: var(--font-serif);
                "
              >
                КОНЕЧНО
              </h3>
              <p style="text-align: center; color: #666">(Of course)</p>

              <div class="quiz-options">
                <button class="quiz-btn" onclick="checkQuiz2(this, true)">[Канешна]</button>
                <button class="quiz-btn" onclick="checkQuiz2(this, false)">[Конечно]</button>
              </div>
              <div id="quiz-feedback-2" class="feedback"></div>
            </div>
          </section>
        </div>

        <aside class="content-note">
          <div class="margin-note">
            <strong>Ассимиляция</strong>
            В русском языке звуки влияют друг на друга. В слове "Водка" глухой К делает соседа Д
            тоже глухим (Т). В слове "Футбол" звонкий Б делает соседа Т тоже звонким (Д). [Фудбол].
          </div>
        </aside>
      </main>

      <footer>
        <div>&copy; 2025 Samovar.</div>
      </footer>
    </div>

    <script>
      // Inline Quiz Logic
      function checkInline(btn, isCorrect, msg) {
        const container = btn.closest('.inline-quiz');
        const feedback = container.querySelector('.inline-feedback');

        container.querySelectorAll('.inline-btn').forEach((b) => {
          b.style.background = 'white';
          b.style.color = 'var(--text-faded)';
          b.style.borderColor = '#ccc';
        });

        if (isCorrect) {
          btn.style.background = 'var(--success-color)';
          btn.style.color = 'white';
          btn.style.borderColor = 'var(--success-color)';
          feedback.innerText = msg;
          feedback.className = 'inline-feedback correct';
        } else {
          btn.style.background = 'var(--error-color)';
          btn.style.color = 'white';
          btn.style.borderColor = 'var(--error-color)';
          feedback.innerText = msg;
          feedback.className = 'inline-feedback incorrect';
        }
      }

      function checkQuiz(btn, correct) {
        if (correct) {
          btn.style.background = '#d4edda';
          btn.style.borderColor = 'green';
          document.getElementById('quiz-feedback').innerHTML =
            '<strong>Верно!</strong> Перед глухим К звонкий Д оглушается в Т.';
          document.getElementById('quiz-feedback').className = 'feedback correct';
        } else {
          btn.style.background = '#f8d7da';
          btn.style.borderColor = 'red';
          document.getElementById('quiz-feedback').innerHTML =
            'Нет. Это сложно, но Д меняется на Т.';
          document.getElementById('quiz-feedback').className = 'feedback incorrect';
        }
      }

      function checkQuiz2(btn, correct) {
        if (correct) {
          btn.style.background = '#d4edda';
          btn.style.borderColor = 'green';
          document.getElementById('quiz-feedback-2').innerHTML =
            "<strong>Верно!</strong> ЧН часто читается как ШН. И 'О' без ударения -> 'А'.";
          document.getElementById('quiz-feedback-2').className = 'feedback correct';
        } else {
          btn.style.background = '#f8d7da';
          btn.style.borderColor = 'red';
          document.getElementById('quiz-feedback-2').innerHTML = 'Нет. Мы говорим [Канешна].';
          document.getElementById('quiz-feedback-2').className = 'feedback incorrect';
        }
      }

      // Sorting Game Logic
      const sortWords = [
        { text: 'Брат', type: 'hard' },
        { text: 'Мать', type: 'soft' },
        { text: 'Стол', type: 'hard' },
        { text: 'День', type: 'soft' },
        { text: 'Семья', type: 'soft' },
        { text: 'Дом', type: 'hard' },
      ];

      const sortPool = document.getElementById('sort-pool');
      const buckets = document.querySelectorAll('.sort-bucket');
      const sortFeedback = document.getElementById('sort-feedback');
      let sortSolved = 0;

      sortWords
        .sort(() => Math.random() - 0.5)
        .forEach((w) => {
          const tile = document.createElement('div');
          tile.className = 'draggable-tile';
          tile.innerText = w.text;
          tile.draggable = true;

          tile.addEventListener('dragstart', (e) => {
            e.dataTransfer.setData('text/plain', JSON.stringify(w));
            setTimeout(() => (tile.style.opacity = '0.5'), 0);
          });

          tile.addEventListener('dragend', () => {
            tile.style.opacity = '1';
          });

          // Mobile tap logic
          tile.addEventListener('click', () => {
            if (tile.classList.contains('correct')) return;

            document
              .querySelectorAll('.draggable-tile')
              .forEach((t) => (t.style.borderColor = 'var(--accent-blue)'));
            tile.style.borderColor = 'orange';
            tile.classList.add('selected-tile');
          });

          sortPool.appendChild(tile);
        });

      buckets.forEach((b) => {
        b.addEventListener('dragover', (e) => {
          e.preventDefault();
          b.classList.add('hovered');
        });

        b.addEventListener('dragleave', () => {
          b.classList.remove('hovered');
        });

        b.addEventListener('drop', (e) => {
          e.preventDefault();
          b.classList.remove('hovered');
          const data = JSON.parse(e.dataTransfer.getData('text/plain'));

          // Find original element
          const original = [...sortPool.children].find(
            (c) => c.innerText === data.text && c.style.display !== 'none',
          );

          handleSort(data, original, b);
        });

        // Click logic
        b.addEventListener('click', () => {
          const selected = document.querySelector('.selected-tile');
          if (selected) {
            const data = sortWords.find((w) => w.text === selected.innerText);
            handleSort(data, selected, b);
            selected.classList.remove('selected-tile');
          }
        });
      });

      function handleSort(data, element, bucket) {
        if (data.type === bucket.dataset.type) {
          // Correct
          const clone = element.cloneNode(true);
          clone.className = 'draggable-tile correct';
          clone.draggable = false;
          bucket.querySelector('.bucket-content').appendChild(clone);
          if (element) element.style.display = 'none';

          sortSolved++;
          if (sortSolved === sortWords.length) {
            sortFeedback.innerText = 'Отлично! Все верно.';
            sortFeedback.className = 'feedback correct';
          }
        } else {
          // Wrong
          if (element) {
            element.style.backgroundColor = 'var(--error-color)';
            element.style.color = 'white';
            setTimeout(() => {
              element.style.backgroundColor = 'white';
              element.style.color = 'var(--text-ink)';
            }, 500);
          }
        }
      }
    </script>
  </body>
</html>
